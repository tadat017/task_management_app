<h1 class="page-title">タスク一覧</h1>

<div class="task-controls">
  <%= link_to '新しいタスクを追加', new_task_path, class: 'btn' %>
</div>

<!-- フィルタフォーム -->
<div class="filter-form">
  <%= form_with url: tasks_path, method: :get, local: true do %>
    <!-- 優先度フィルタ -->
    <%= select_tag :priority, options_for_select([['全て', ''], ['低', 0], ['中', 1], ['高', 2]], params[:priority]), prompt: '優先度でフィルタ', class: 'priority-select' %>
    
    <!-- 期限切れタスクのフィルタ -->
    <%= select_tag :expired, options_for_select([['全て', ''], ['期限切れ', 'true'], ['期限内', 'false']], params[:expired]), prompt: '期限状態でフィルタ', class: 'expired-select' %>
    
    <!-- 完了状態のフィルタ -->
    <%= select_tag :completed, options_for_select([['全て', ''], ['完了', 'true'], ['未完了', 'false']], params[:completed]), prompt: '完了状態でフィルタ', class: 'completed-select' %>
    
    <%= submit_tag 'フィルタ', class: 'btn' %>
  <% end %>
</div>

<!-- タスク一覧表示 -->
<ul class="task-list">
  <% @tasks.each do |task| %>
    <li class="task-item">
      <%= task.title %> - <%= task.deadline.present? ? task.deadline.strftime("%Y-%m-%d") : '期限なし' %>
      [<%= task.completed ? '完了' : '未完了' %>]
      <div class="task-actions">
        <%= link_to '編集', edit_task_path(task), class: 'btn edit-btn' %> |
        <%= link_to '削除', task_path(task), data: { turbo_method: :delete }, class: 'btn delete-btn' %> |
        <%= link_to task.completed ? '未完了にする' : '完了にする', toggle_complete_task_path(task), data: { turbo_method: :patch }, class: 'btn toggle-complete-btn' %>
      </div>
    </li>
  <% end %>
</ul>

<div class="delete-expired-tasks">
  <%= link_to '期限切れタスクを一括削除', delete_expired_tasks_path, data: { turbo_method: :delete }, class: 'btn delete-btn' %>
</div>
