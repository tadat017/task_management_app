<h1>タスク一覧</h1>

<%= link_to '新しいタスクを追加', new_task_path %>

<!-- 現在のフィルタ状態を表示 -->
<% if params[:completed] == 'true' %>
  <p>現在表示中: 完了済みタスク</p>
<% else %>
  <p>現在表示中: 未完了タスク</p>
<% end %>

<% if params[:expired] == 'true' %>
  <p>期限切れタスクが表示されています</p>
<% else %>
  <p>期限切れタスクは非表示です</p>
<% end %>

<!-- 優先度フィルタ -->
<%= form_with url: tasks_path, method: :get, local: true do %>
  <%= select_tag :priority, options_for_select([['全て', ''], ['低', 0], ['中', 1], ['高', 2]], params[:priority]), prompt: '優先度でフィルタ' %>
  <%= submit_tag 'フィルタ' %>
<% end %>

<!-- 完了済みタスクの表示/非表示切り替えリンク -->
<%= link_to params[:completed] == 'true' ? '未完了タスクのみ表示' : '完了済みタスクを表示', tasks_path(priority: params[:priority], completed: params[:completed] == 'true' ? 'false' : 'true') %>

<!-- 期限切れタスクの表示/非表示切り替えリンク -->
<%= link_to params[:expired] == 'true' ? '期限切れタスクを非表示' : '期限切れタスクを表示', tasks_path(priority: params[:priority], expired: params[:expired] == 'true' ? 'false' : 'true') %>

<!-- タスク一覧表示 -->
<ul>
  <% @tasks.each do |task| %>
    <li>
      <%= task.title %> - <%= task.deadline.strftime("%Y-%m-%d") %> 
      [<%= task.completed ? '完了' : '未完了' %>]
      <%= link_to '編集', edit_task_path(task) %> |
      <%= link_to '削除', task_path(task), data: { turbo_method: :delete } %> |
      <%= link_to task.completed ? '未完了にする' : '完了にする', toggle_complete_task_path(task), method: :patch %>
    </li>
  <% end %>
</ul>
